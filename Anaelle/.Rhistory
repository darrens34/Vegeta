library(FactoMineR)
library(factoextra) # pour les graphes
library(tidyverse)
library(dplyr)
library(tidyr)
library(pls)
############# Importer les données
path<-"F:/MIASHS/TER/Vegeta/data/data_train_test/Puechabon_train.csv"
donnes_train<-read.table(path,sep=",",dec=".",header=T,na.strings = c("-9999","NA"))
donnes_train$type<-"train"
path<-"F:/MIASHS/TER/Vegeta/data/data_train_test/Puechabon_test.csv"
donnes_test<-read.table(path,sep=",",dec=".",header=T,na.strings = c("-9999","NA"))
donnes_test$type<-"test"
setwd("F:/MIASHS/TER/Vegeta/Anaelle")
summary(donnes_train)
donnes_train = donnes_train[,-which(colnames(donnes_train)=="X")]# supprime premier colonne d'index
#############  Transforme les dates
donnes_train$dates = strptime(donnes_train$date,format = "%Y-%m-%d %H:%M:%S")
donnes_train$heure_solaire = strptime(donnes_train$heure_solaire,format = "%H:%M")
#############  Supprime colonnes inutiles pour le moment
donnees<- donnes_train[,-which(names(donnes_train) %in% c("dates","heure_solaire","type"))]
######### ######### #########
######### Relation sigmoidale
######### ######### #########
# Asym : asymptote
# xmid : Point d'inflection : 50% de Y
# scal : scale parameter
compt=0
xmid=0
scal=0
flogis <- function(x,  xmid, scal)9/(1+exp((xmid-x)/scal))
for (i in c("TA", "SB", "G","LE_30m", "VPD")){
compt=compt+1
#Ajust
y<-donnees$SAP_FLOW
x<-donnees[,which(names(donnees)==i)]
# Plot obs:
plot(y~x,xlab=i,ylab="sap flow")
fit0<-NULL
fit0<-nls(y ~ flogis(x, xmid, scal), data = data.frame(x, y),control=nls.control(maxiter = 100000),start=list( xmid=10, scal=3))
xmid[compt]<-summary(fit0)$coef[1]
scal[compt]<-summary(fit0)$coef[2]
xplot<-min(x,na.rm=T):max(x,na.rm=T)
points(9.5 / ( 1 + exp ((xmid[compt]-xplot) / scal[compt])) ~ xplot,type="l",col="red",lwd=4)
trans <- 9.5/ ( 1 + exp ((xmid[compt]- x) / scal[compt]))
plot(donnees$SAP_FLOW~trans,xlab =i)
trans_nom <- paste0(i,"_trans")
donnees$trans_nom<-trans
}
i = "CO2"
compt=compt+1
#Ajust
y<-donnees$SAP_FLOW
x<-donnees[,which(names(donnees)==i)]
# Plot obs:
plot(y~x,xlab=i,ylab="sap flow")
points(abs(9.8/(xplot-390)) ~ xplot,type="l",col="red",lwd=4)
xplot<-330:max(x,na.rm=T)
points(abs(9.8/(xplot-390)) ~ xplot,type="l",col="red",lwd=4)
trans <- abs(9.8/(x-390))
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,200))
trans <- x+1/x
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,200))
trans <- 1/(x+1)
plot(donnees$SAP_FLOW~trans,xlab =i)
trans <- x/(x+1)
plot(donnees$SAP_FLOW~trans,xlab =i)
trans <- x+1/x
plot(donnees$SAP_FLOW~trans,xlab =i)
trans <- x+1/x
plot(donnees$SAP_FLOW~trans,xlab =i)
x+1/x
trans <- 1/(x+1)
plot(donnees$SAP_FLOW~trans,xlab =i)
y<-donnees$SAP_FLOW
x<-donnees[,which(names(donnees)==i)]
?nls
nls( y~  A * exp(B*(1/(x+1))), start=c(A=10,B=10) , data = data.frame(x,y))
trans <- 1 * exp(2*(1/(x+1)))
points(1 * exp(B*(2/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(1 * exp(2*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
1 * exp(2*(1/(xplot+1)))
xplot
plot(y~x,xlab=i,ylab="sap flow")
points(1/(xplot+1) ~ xplot,type="l",col="red",lwd=4)
trans <- 1/(xplot+1)
trans <- 1/(x+1)
plot(donnees$SAP_FLOW~trans,xlab =i)
1 * exp(2*(1/(xplot+1)))
10 * exp(2*(1/(xplot+1)))
xplot
400 * exp(2*(1/(xplot+1)))
points(400 * exp(2*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.001 * exp(2*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
0.001 * exp(2*(1/(xplot+1)))
points(0.002 * exp(2*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
0.002 * exp(2*(1/(xplot+1)))
points(10 * exp(2*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(5 * exp(2*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(5 * exp(2*(1/(xplot+1))) ~ 1/(xplot+1),type="l",col="red",lwd=4)
5 * exp(2*(1/(xplot+1)))
plot(y~x,xlab=i,ylab="sap flow")
points(5 * exp(2*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
5 * exp(2*(1/(xplot+1)))
points(5 * exp(10*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(5 * exp(100*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(5 * exp(1000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
5 * exp(1000*(1/(xplot+1)))
points(1 * exp(1000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(1 * exp(100*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.1 * exp(10000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
0.1 * exp(10000*(1/(xplot+1)))
points(0.001 * exp(10000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
0.001 * exp(10000*(1/(xplot+1)))
points(0.001 * exp(4000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.001 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.01 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.005 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.005 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.002 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.0005 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.0001 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.00001 * exp(5000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.0000001 * exp(8000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.00000001 * exp(8000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(8000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.00000005 * exp(8000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000003 * exp(8000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.00000002 * exp(8000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000005 * exp(8000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000005 * exp(9000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000005 * exp(9000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000001 * exp(9000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(9000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(10000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(10000*(1/(xplot+2))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(10000*(1/(xplot+100))) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.000000001 * exp(10000*(1/(xplot+100))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(10000*(1/(xplot+1))) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(10000*(1/xplot)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000001 * exp(1000000*(1/xplot)) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000001 * exp(1000000*(1/xplot)) ~ xplot,type="l",col="red",lwd=4)
0.00000000001 * exp(1000000*(1/xplot))
points(0.000000001 * exp(10000*(1/xplot)) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(1/(xplot+1) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 * exp(10000/(xplot+10)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 * exp(10000/xplot²) ~ xplot,type="l",col="red",lwd=4)
0.00000000005 * exp(10000/xplot²)
points(0.00000000005 * exp(10000/xplot^2) ~ xplot,type="l",col="red",lwd=4)
0.00000000005 * exp(10000/xplot^2)
0.5 * exp(10000/xplot^2)
points(400 * exp(10000/xplot^2) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(400 * exp(10000/xplot^2) ~ xplot,type="l",col="red",lwd=4)
400 * exp(10000/xplot^2)
points(5 * exp(10000/xplot^2) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 *xplot^1000 ~ xplot,type="l",col="red",lwd=4)
0.00000000005 *xplot^1000
0.00000000005 *xplot^2
points(0.00005 *xplot^2 ~ xplot,type="l",col="red",lwd=4)
0.05 *(1/xplot)^2
5000 *(1/xplot)^2
50000 *(1/xplot)^2
500000 *(1/xplot)^2
points(500000 *(1/xplot)^2 ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(500000 *(1/xplot)^2 ~ xplot,type="l",col="red",lwd=4)
points(500000 *(1/xplot)^3 ~ xplot,type="l",col="red",lwd=4)
500000 *(1/xplot)^3
points(50000000 *(1/xplot)^3 ~ xplot,type="l",col="red",lwd=4)
50000000 *(1/xplot)
5000 *(1/xplot)
points(5000 *(1/xplot) ~ xplot,type="l",col="red",lwd=4)
points(500 *(1/xplot) ~ xplot,type="l",col="red",lwd=4)
p
points(0.00000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
trans <- 0.00000000005 * exp(10000/x)
plot(donnees$SAP_FLOW~trans,xlab =i)
plot(donnees$SAP_FLOW~trans,xlab =i,xlab=c(0,10))
plot(donnees$SAP_FLOW~trans,xlab=c(0,10))
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,10))
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
points(1/(xplot+1) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 * exp(50000/xplot) ~ xplot,type="l",col="red",lwd=4)
0.00000000005 * exp(50000/xplot)
0.00000005 * exp(100/xplot)
0.005 * exp(100/xplot)
1* exp(100/xplot)
points(0.00000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000003 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
trans <- 0.00000000003 * exp(10000/x)
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000003 * exp(10000/(xplot-1)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000003 * exp(10000/(xplot)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000003 * exp(10000/(xplot-10)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000003 * exp(10000/(xplot-20)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000001 * exp(10000/(xplot-20)) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000001 * exp(10000/(xplot-20)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000001 * exp(10000/(xplot-50)) ~ xplot,type="l",col="red",lwd=4)
points(0.000000000001 * exp(10000/(xplot-50)) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.000000000001 * exp(10000/(xplot-50)) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000000001 * exp(10000/(xplot-100)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000000001 * exp(10000/(xplot-100)) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000000001 * exp(10000/(xplot-100)) ~ xplot,type="l",col="red",lwd=4)
points(0.000000000000001 * exp(10000/(xplot-100)) ~ xplot,type="l",col="red",lwd=4)
points(0.000000000000005 * exp(10000/(xplot-100)) ~ xplot,type="l",col="red",lwd=4)
points(0.000000000000005 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000000000005 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000000000001 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000000000001 * exp(1000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
0.00000000000000001 * exp(1000/(xplot-200))
0.0001 * exp(1000/(xplot-200))
1 * exp(1000/(xplot-200))
0.1 * exp(1000/(xplot-200))
points(0.1 * exp(1000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.000000000000000001 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000000000000001 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000000000000001 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000000000000000001 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.0000000000000000000001 * exp(10000/(xplot-200)) ~ xplot,type="l",col="red",lwd=4)
trans <- 0.0000000000000000000001 * exp(10000/(xplot-200))
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
trans <- 0.0000000000000000000001 * exp(10000/(x-200))
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
points(0.000000000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
0.000000000000001 * exp(10000/xplot)
points(0.000000000000001 * exp(100000/xplot) ~ xplot,type="l",col="red",lwd=4)
0.000000000000001 * exp(10000/xplot)
0.000000000000001 * exp(100000/xplot)
0.000000000001 * exp(10000/xplot)
0.0000000001 * exp(10000/xplot)
0.00000001 * exp(10000/xplot)
points(0.000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
0.000001 * exp(10000/xplot)
points(0.0000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.0000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
plot(y~x,xlab=i,ylab="sap flow")
points(0.0000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000001 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000005 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
points(0.00000000003 * exp(10000/xplot) ~ xplot,type="l",col="red",lwd=4)
trans <- 0.00000000003 * exp(10000/x)
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000003 * exp(10000/(xplot-2)) ~ xplot,type="l",col="red",lwd=4)
trans <- 0.00000000003 * exp(10000/(x-2))
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
trans <- 0.00000000002 * exp(10000/x))
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
trans <- 0.00000000002 * exp(10000/x)
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
plot(y~x,xlab=i,ylab="sap flow")
points(0.00000000002 * exp(10000/(xplot-2)) ~ xplot,type="l",col="red",lwd=4)
trans <- 0.00000000002 * exp(10000/x)
plot(donnees$SAP_FLOW~trans,xlab =i,xlim=c(0,20))
